blog:
  image: gold/ghost
  restart: always
  volumes:
    - '/var/lib/ghost:/var/lib/ghost'
  environment:
    - NODE_ENV=production
    - GHOST_URL=https://blog.coursetrakr.io/
    - MAIL_FROM='"Staff" <staff@mail.coursetrakr.io>'
    - MAIL_HOST=mail.coursetrakr.io
    - PROD_FORCE_ADMIN_SSL=true
    - MAIL_SSL=true
    - MAIL_PORT=465
    - MAIL_USERNAME=ghost@coursetrakr.io
    - MAIL_PASSWORD=WisrocLinden1
    - VIRTUAL_HOST=blog.coursetrakr.io
    - LETSENCRYPT_HOST=blog.coursetrakr.io
    - LETSENCRYPT_EMAIL=tev.jeffrey@gmail.com
  tags:
    - production

db:
  image: 'tevjef/uct-core:postgres'
  environment:
    - POSTGRES_DB=universityct
    - POSTGRES_PASSWORD=WisrocLinden1
    - POSTGRES_USER=uct
  ports:
    - '5432:5432'
  restart: always
  tags:
    - production
  volumes:
    - '/var/lib/uct/postgresql:/var/lib/postgresql'
ein:
  image: 'tevjef/uct-core:ein'
  links:
    - db
    - influxdb
    - redis
  restart: always
  tags:
    - production
grafana:
  image: 'grafana/grafana:latest'
  environment:
    - GF_SECURITY_ADMIN_PASSWORD=WisrocLinden1
    - 'GF_SERVER_ROOT_URL=https://grafana.coursetrakr.io'
    - GF_USERS_ALLOW_ORG_CREATE=false
    - GF_USERS_ALLOW_SIGN_UP=false
    - LETSENCRYPT_EMAIL=tev.jeffrey@gmail.com
    - LETSENCRYPT_HOST=grafana.coursetrakr.io
    - VIRTUAL_HOST=grafana.coursetrakr.io
  links:
    - influxdb
  restart: always
  tags:
    - production
  volumes:
    - '/var/lib/grafana:/var/lib/grafana'
hermes:
  image: 'tevjef/uct-core:hermes'
  links:
    - db
    - influxdb
  restart: always
  tags:
    - production
influxdb:
  image: 'influxdb:alpine'
  environment:
    - INFLUXDB_HTTP_AUTH_ENABLED=true
    - UCT_INFLUXDB_PASSWORD=WisrocLinden1_influx
    - VIRTUAL_HOST=influxdb.coursetrakr.io
    - VIRTUAL_PORT=8083
  ports:
    - '8083:8083'
    - '8086:8086'
  restart: always
  tags:
    - production
  volumes:
    - '/var/lib/influxdb:/var/lib/influxdb'


letsencrypt-nginx-proxy:
  image: 'jrcs/letsencrypt-nginx-proxy-companion:latest'
  tags:
    - production
  volumes:
    - '/etc/nginx/certs:/etc/nginx/certs'
    - '/var/run/docker.sock:/var/run/docker.sock:ro'
  volumes_from:
    - nginx-proxy
nginx-proxy:
  image: 'tevjef/uct-core:nginx-proxy'
  expose:
    - '8090'
  ports:
    - '80:80'
    - '443:443'
  tags:
    - production
  volumes:
    - '/etc/nginx/certs:/etc/nginx/certs:ro'
    - /etc/nginx/vhost.d
    - /usr/share/nginx/html
    - '/var/run/docker.sock:/tmp/docker.sock:ro'
redis:
  image: 'redis:alpine'
  restart: always
  tags:
    - production
rutgers-cm:
  image: 'tevjef/uct-core:rutgers-cm'
  links:
    - redis
  mem_limit: 40m
  restart: always
  tags:
    - production
rutgers-nb:
  image: 'tevjef/uct-core:rutgers-nb'
  links:
    - redis
  mem_limit: 90m
  restart: always
  tags:
    - production
rutgers-nk:
  image: 'tevjef/uct-core:rutgers-nk'
  links:
    - redis
  mem_limit: 40m
  restart: always
  tags:
    - production
spike:
  image: 'tevjef/uct-core:spike'
  environment:
    - LETSENCRYPT_EMAIL=tev.jeffrey@gmail.com
    - LETSENCRYPT_HOST=api.coursetrakr.io
    - 'VIRTUAL_HOST=api.coursetrakr.io,foreman.tevindev.me'
    - VIRTUAL_PORT=9876
  links:
    - db
    - influxdb
    - redis
  restart: always
  tags:
    - production
telegraf:
  image: 'tevjef/uct-core:telegraf'
  links:
    - db
    - influxdb
    - redis
  tags:
    - production
  volumes:
    - '/var/run/docker.sock:/tmp/docker.sock:ro'
    - '/var/run/utmp:/var/run/utmp:ro'
